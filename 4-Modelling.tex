\chapter{Orbital dynamics and modelling} \label{cha:Orbital-dynamics-and-modelling}

% Epoch
\section{Epoch} \label{sec:Epoch}

In any dynamic system, time is one of the most important parameters. Since the Universe is constantly changing, most of it beyond human control, any timescale needs an arbitrary starting point assigned. The current best practice is to use the epoch J2000, defined as noon, 1st~January~2000, Terrestrial Time~(TT). Terrestrial time is a theoretical time standard allowing for gravitational time dilation at the Earth's surface (general relativity) and the Lorentz transformation for moving bodies (special relativity); however, the Earth's rotation is also slowing down, so another transformation is needed to convert to Universal Coordinate Time~(UTC) as outlined by the United States Naval Observatory~(USNO) \textcite{web_TimeServiceDept.2008}.

Due to the discontinuous timescales traditionally used for time (seconds, minutes, hours, days and years) there are a number of measures commonly used to identify time. The Julian date~(JD) is the time in days and fractions of a day since noon, 1st~January~4713BC~UTC, giving the J2000 epoch a JD of 2451545.0~TT. For the optimisation, a fixed offset of 5113.5 bringing the epoch up to midnight, 1st~January~2014. Adding the optimisable parameter for departure date gives the start of the trajectory. The time scales on the figures in \autoref{cha:Results} are relative to this departure date. For other applications, most notably the STK simulations described in \autoref{sec:STK}, another continuous time scale was used called Ephemeris Time. As outlined by the \textcite{NAIF2010}, Ephemeris Time is the number of seconds since the J2000 epoch.




% Reference frame
\section{Reference frames} \label{sec:Reference-frames}

In order to model a dynamic rigid body system, it is important to first define the appropriate reference frames. The International Earth Rotation Service (IERS) defined the International Celestial Reference Frame (ICRF) as a quasi-inertial frame centred on the barycentre of the solarsystem \parencite{Ma1998}. %{shown in Figure XX}
Relativity requires that no truly inertial frames can exist, but by defining the ICRF relative to extragalactic microwave sources the angular rotation of the frame is so slow it can be assumed to be negligible.

The fundamental $XY$ plane coincides the Earth's equatorial plane at Julian epoch J2000. The $x$-axis is defined as the intersection of the equatorial and ecliptic planes (the ecliptic plane is the plane within which the Earth orbits the Sun), with positive being towards the Earth during the March (vernal) equinox at Julian epoch J2000. Because this direction points roughly towards the constellation Aries it is often denoted $\Aries$, as shown in \autoref{fig:Ecliptic-plane}. This coordinate system is useful as an absolute reference within the solar system. However, since the majority of \BW's trajectory will be an Earth escape spiral, an Earth-centred inertial (ECI) reference frame will be used.

\begin{figure}
\caption{Ecliptic and equatorial planes. From an Earth-centred frame, the Sun appears to orbit the Earth. The plane of its orbit is the ecliptic plane. Image used courtesy of Dr. Guy Worthey, \url{http://astro.wsu.edu/worthey/astro/html/lec-celestial-sph.html}.} \label{fig:Ecliptic-plane}
\centering
\includegraphics [scale=0.45]{Images/cel-sphere-2.png}
\end{figure}

ECI frames are also quasi-inertial, because there are residual centrifugal forces within the frame as the origin (the Earth) orbits around the Sun and the Sun orbits around the galactic centre. The galactic rotation is neglected as mentioned above. The forces due to the Earth's orbit around the Sun are compensated for by including the Sun as a gravitational perturbation (as outlined in \autoref{sub:Ephemerides}).

While it is possible to translate the ICRF to be Earth-centred, the ICRF has not been universally adopted yet. In particular, the NASA SPICE libraries use an older standard, the J2000.0 frame (not to be confused with the J2000 epoch, upon which it is dependent), based on optical measurements of galactic stars called the FK5 catalogue. Due to this discrepancy in measurement, the J2000 reference frame is offset from the ICRF  by a small rotation: the J2000 pole offset is about 18 milliarcseconds (mas) and the equinox offset is approximately 78~mas, increasing by about 3~mas per year \parencite{Gontier2002}. 
The optimisations performed in GESOP were restricted to the J2000.0 frame, so it was also used in the STK simulations.
%\url{http://naif.jpl.nasa.gov/pub/naif/GRAIL/kernels/fk/moon_080317.tf}.

Surface coverage analysis and higher order gravitational forces (discussed in \autoref{sub:Oblateness}) require an additional frame that rotates about the poles (the $z$-axis) in time with the body's rotation, so that the surface appears stationary. This is often called a surface-fixed frame, but is sometimes given a dedicated name (for example, the lunar-centred fixed frame is often called \emph{selenocentric}, and the Earth-fixed frame is often called \emph{geodetic}). The IERS maintains an Earth-centred fixed (ECF) frame called the International Terrestrial Reference Frame (ITRF). The NASA SPICE libraries implement ITRF93, which allows for precession based on the 1976~IAU model by \textcite{Lieske1977}, nutation based on the 1980 model with IERS corrections by \textcite{Herring1986}, the differences between terrestrial time and atomic sidereal time, and polar motion.

During the lunar descent the spacecraft is orbiting the Moon. Since most coordinate systems (discussed in \autoref{sec:Orbital-Elements}) are designed to have the central body at the origin, a lunar-centred inertial (LCI) frame will be used for these phases. Conversion to lunar centred frames requires accurate determination of the Moon's position, addressed in \autoref{sub:Ephemerides}. For higher order gravitational forces, a fixed lunar frame is available in both STK and SPICE known as the Mean Earth frame. The $z$-axis is defined along the primary inertial axis of the Moon, while the $x$-axis is defined towards the mean position of the Earth relative to the Moon (since the Moon is tidally locked to the Earth) \parencite{LCF}.
%Lunar reference frames %\url{http://naif.jpl.nasa.gov/naif/lunar_kernels.txt} 

Finally, to model the forces acting on the spacecraft it is necessary to define a local frame. Within the ECI frame, $\vec{r}$ represents the position vector of the spacecraft from the origin (defined as the centre of the primary body), as shown in \autoref{fig:Earth-Centred-Inertial-frame}, while $\vec{v}$ is the velocity vector of the spacecraft.
\begin{figure}
\caption{Earth-Centred Inertial frame. Image used couresty of \textcite{Keppeler_thesis}.} \label{fig:Earth-Centred-Inertial-frame}
\centering
\includegraphics[scale=0.75]{Images/ECI-frame.JPG}
\end{figure}
Designating the position vector as the local vertical, and the tangent relative to the central body as the local horizontal, this defines a local frame known as the Gauss frame, or the Local Vertical-Local Horizontal (LVLH) frame \parencite{STK}. It is important to note that the local horizontal is not necessarily parallel to the velocity.

For compatability with the majority of cited literature, including \textcite{Keppeler_thesis}'s comprehensive study of various coordinate systems applicable to orbital dynamics, the following notation shall be used throughout this paper. The radial direction (from the centre of the primary body to the orbiting spacecraft) is a unit vector based on the spacecraft's position $\vec{r}$, and may be derived using equation\eqref{eq:ir}.
\begin{subequations}\label{eq:i}
\begin{equation}
\vec{\hat{i}}_{r}=\frac{\vec{r}}{\left\Vert \vec{r}\right\Vert} \label{eq:ir}
\end{equation}

The normal direction, $\vec{\hat{i}}_{h}$, is perpendicular to the orbital plane. The subscript $h$ is used because this vector is in the direction of specific angular momentum, $\vec{h=r\times v}$. Since $\vec{r}$ and $\vec{v}$ are both within the orbital plane, this vector may be derived using equation \eqref{eq:ih}.
\begin{equation}
\vec{\hat{i}}_{h}=\frac{\vec{r\times v}}{\left\Vert \vec{r\times v}\right\Vert} \label{eq:ih}
\end{equation}

The tangential direction, $\vec{\hat{i}}_{\theta}$, is perpendicular to radial direction, but still within the orbital plane. It is important to note that this direction is not necessarily parallel to velocity, and so should be derived using equation \eqref{eq:it}.
\begin{equation}
\vec{\hat{i}}_{\theta}=\vec{\hat{i}}_{h}\times\vec{\hat{i}}_{r} \label{eq:it}
\end{equation}
\end{subequations}

\begin{figure}
\caption{Local Gauss frame. Image used courtesy of \textcite{Keppeler_thesis}. Vector $\vec{r}$ represents the spacecraft's position relative to the primary body. True anomaly $\nu$ represents the angle of this position relative to the periapsis. Vector $\vec{v}$ represents the spacecraft's velocity. Angle $\Psi$ represents the deviation of this velocity from the tangent to the circle described by $\vec{r}$.} \label{fig:LVLH-frame}
\centering
\includegraphics[scale=0.50]{Images/local-orbit.JPG}
\end{figure}




% Orbital elements
\section{Orbital elements} \label{sec:Orbital-Elements}

Orbital motion essentially stems from \textcite{Newton1687}'s universal law of gravitation, 
\begin{equation}
\vec{F}=-m\frac{\mu}{r^{2}}\vec{\hat{i}_{r}} \label{eq:Fgravity}
\end{equation}
where $\mu$ represents the gravitational constant of the primary body, $m$  represents the mass of the orbiting body and $r$ represents the distance between the two.
 
\textcite{Kaplan1976} provides a thorough derivation of orbital dynamics demonstrating that in the absence of external forces this law results in elliptical motion (when escape velocity is not exceeded). % which is reproduced in Appendix \ref{cha:Derivation-of-Newtonian} for completeness

As described by \textcite{Letterio_thesis}, Cartesian positions and velocities are not suitable elements for modelling elliptical motion because they result in complex trigonometric equations for even the simple case of circular motion. Keplerian coordinates (semi-major axis $a$, eccentricity $e$, inclination $i$, argument of periapsis $\omega$, longitude of the ascending node $\Omega$ and true anomaly $\nu$) shown in \autoref{fig:Keplerian-Orbital-Elements} describe orbits very efficiently. Unfortunately, Keplerian coordinates exhibit singularities as inclination or eccentricity approach zero, causing computational difficulties during optimisation\footnote{Division by a parameter close to zero creates a \emph{fast variable}, where even small changes in one parameter can result in large changes to another. This requires very small step sizes when using numerical integration, hence increasing the number of computations required. Furthermore, when $e$ is equal to zero, $\omega$ is undefined (a circular orbit does not have a periapsis) and when the $i$ is equal to zero, $\Omega$ is undefined (an equatorial orbit does not have an ascending node).}.

%model keplerian coordinates diagram on \cite{Pollard2000}

\begin{figure} [h]
\caption{Keplerian orbital elements. Image used courtesy of \textcite{Keppeler_thesis}.} \label{fig:Keplerian-Orbital-Elements}
\centering
\includegraphics[scale=0.75]{Images/Keplerian-elements.JPG}
\end{figure}

This severely limits the step size that can be used during optimisation without accumulating large errors in the calculations. Therefore the recent trend is to use equinoctial elements for optimising orbital trajectories. A review of orbital element sets by \textcite{Hintz2008} came to the same conclusion as \citeauthor{Letterio_thesis} and \citeauthor{Keppeler_thesis}: the elements resulting in the smoothest trajectories are the \emph{modified equinoctial element set} proposed by \textcite{Walker1985}, defined in \eqref{eq:states},
\begin{subequations}\label{eq:states}
\begin{eqnarray}
p & = & a(1-e^{2}) \label{eq:p}\\
f & = & e\cos(\omega+\Omega) \label{eq:f}\\
g & = & e\sin(\omega+\Omega) \label{eq:g}\\
h & = & \tan\frac{i}{2}\cos\Omega \label{eq:h}\\
k & = & \tan\frac{i}{2}\sin\Omega \label{eq:k}\\
L & = & \omega+\Omega+\nu \label{eq:L}
\end{eqnarray}
\end{subequations}
where $p$ represents the semi-latus rectum, as explained in \autoref{sec:Orbits}, $L$ represents the true longitude and $f$, $g$, $h$ and $k$ are convenient non-singular transformations of the Keplerian elements, with no physical meaning.

This lack of physical meaning has hindered the uptake of the modified equinoctial element set. Many published studies still use Keplerian or even Cartesian coordinates, and many widely used textbooks do not even mention the element set. For example \textcite[][p. 194]{Chobotov2002} outlines the original set of equinoctial elements proposed by \textcite{Broucke1972}, but neglects the modified set.





% Orbital equations of motion
\section{Orbital equations of motion} \label{sec:Orbital-equations-of-motion}

Differentiating equation \eqref{eq:states} defining the equinoctial elements and then substituting through by those same equations to remove the Keplerian terms, gives the Gaussian equations of motion as presented by \textcite{Walker1985,Walker1986,Keppeler_thesis,Erb_thesis,Letterio_thesis,Hintz2008} \footnote{Note the equation for $\dot{g}$ was corrected in \textcite{Walker1986}. This correction is sometimes missed in later publications, such as \textcite{Hintz2008}.},
\begin{subequations}\label{eq:state-updates}
\begin{eqnarray}
\dot{p} = & \sqrt{\frac{p}{\mu}}\frac{2p}{w}\Delta_\theta \label{eq:pdot}\\
\dot{f} = & \sqrt{\frac{p}{\mu}}\left(\Delta_r\sin L+\frac{\left(w+1\right)\cos L+f}{w}\Delta_\theta-\frac{g\left(h\sin L-k\cos L\right)}{w}\Delta_h \right) \label{eq:fdot}\\
\dot{g} = & \sqrt{\frac{p}{\mu}}\left(-\Delta_r\cos L+\frac{\left(w+1\right)\sin L+g}{w}\Delta_\theta+\frac{f\left(h\sin L-k\cos L\right)}{w}\Delta_h \right) \label{eq:gdot}\\
\dot{h} = & \sqrt{\frac{p}{\mu}}\frac{s^{2}\cos L}{2w}\Delta_h \label{eq:hdot}\\
\dot{k} = & \sqrt{\frac{p}{\mu}}\frac{s^{2}\sin L}{2w}\Delta_h \label{eq:kdot}\\
\dot{L} = & \sqrt{\frac{p}{\mu}}\left(\frac{h\sin L-k\cos L}{w}\Delta_h \right)+\sqrt{\mu p}\left(\frac{w}{p}\right)^{2} \label{eq:Ldot}
\end{eqnarray}
simplified (and made more computationally efficient) using the terms
\begin{eqnarray}
w & = & 1+f\cos L+g\sin L\label{eq:w_helper}\\
s^{2} & = & 1+h^{2}+k^{2}\label{eq:s2_helper}
\end{eqnarray}
\end{subequations}
where $\mu$ represents the gravitational constant of the primary body \linebreak (3986004.418$\times$10$^8$~m$^3$s$^{-2}$ for the Earth as per \cite{WGS84} and  $4902.7989\times10^9$~m$^3$s$^{-2}$ for the Moon as per \cite{Zhang1994}). The perturbations $\Delta_r$, $\Delta_\theta$ and $\Delta_h$ represent the total acceleration due to forces other than the primary body's classical gravity, split into vector components using the LVLH frame outlined in \autoref{sec:Reference-frames}. Note that $\Delta_\theta$ is not necessarily parallel to the velocity vector. Also note that in the absence of perturbations, the only time-varying element is $L$, the true longitude. This is because the other elements specify an orbit, whereas the true longitude represents the position of the orbiting body within that orbit. In the absence of perturbing forces the orbit remains constant.




%-----------------------------------------------------------------------------------------------------------------------------------------------
% Perturbations
\section{Perturbations} \label{sec:Perturbations}

The total perturbing force [$\Delta_r$ $\Delta_\theta$ $\Delta_h$] outlined in \autoref{sec:Orbital-equations-of-motion} is resolved from the oblateness of the primary body $\vec{\Delta_g}$, the influence of secondary bodies $\vec{\Delta_q}$ and the applied thrust of the spacecraft $\vec{\Delta_T}$. \textcite{Erb_thesis} states that, \enquote{The acceleration $\vec{\Delta_q}$ can, depending upon the overall situation, either be something to take advantage of, or something that needs to be compensated}. This sentence summarises one of the key objectives of this study: to plan the spacecraft's trajectory such that the gravitational assists $\vec{\Delta_q}$ increase the velocity of the spacecraft relative to the Earth as much as possible, thereby reducing the thrust requirements on the propulsion system.



% Third body ephemerides
\subsection{Third-body perturbations} \label{sub:Ephemerides}

Reviewed literature unanimously agrees that the most accurate model available for relative positions of bodies within the solar system is the NASA JPL Planetary and Lunar Ephemerides. This data is accessible from \textcite{web_JetPropulsionLaboratory2004}, in the form of Cartesian coordinates for celestial bodies at any given Julian Date. Many prior studies have used the JPL DE-405 Ephemeris, but for this project the JPL Ephemeris DE-421 were implemented through the NASA SPICE libraries. As explained in their supporting documentation, \enquote{While the lunar orbit in DE 421 is close to that in DE 418, it is a major improvement over the widely distributed DE 405 (Standish 1998). For DE 405 the lunar orbit was not fit in a way consistent with the other planets} \parencite{DE421}.

To calculate the distance between the respective bodies, it is necessary to translate the spacecraft's position into Cartesian coordinates. \textcite{Betts1994} derives the set of equations shown in \eqref{eq:cartesian} for this purpose, although more recent literature often makes typographical mistakes when reproducing them, particularly with regard to the signs of some terms (for example \cite{Keppeler_thesis,Erb_thesis,Letterio_thesis}),
\begin{subequations}\label{eq:cartesian}
\begin{eqnarray}
r_{x} = & \frac{r}{s^{2}}\left(\cos(L)+\alpha^{2}\cos(L)+2hk\sin(L)\right)\label{eq:r_x}\\
r_{y} = & \frac{r}{s^{2}}\left(\sin(L)-\alpha^{2}\sin(L)+2hk\cos(L)\right)\label{eq:r_y}\\
r_{z} = & \frac{2r}{s^{2}}\left(h\sin(L)-k\cos(L)\right)\label{eq:r_z}\\\notag
v_{x} = & -\frac{1}{s^{2}}\sqrt{\frac{\mu}{p}}\left(\sin(L)+\alpha^{2}\sin(L)-2hk\cos(L)+g\right.\\
&\left.-2fhk+\alpha^{2}g\right)\label{eq:v_x}\\\notag
v_{y} = & -\frac{1}{s^{2}}\sqrt{\frac{\mu}{p}}\left(-\cos(L)+\alpha^{2}\cos(L)+2hk\sin(L)-f\right.\\
&\left.+2ghk+\alpha^{2}f\right)\label{eq:v_y}\\
v_{z} = & \frac{2}{s^{2}}\sqrt{\frac{\mu}{p}}\left(h\cos(L)+k\sin(L)+fh+gk\right)\label{eq:v_z}
\end{eqnarray}
\end{subequations}
where $r_{x,y,z}$ and $v_{x,y,z}$ are the position and velocity respectively of the spacecraft in Cartesian axes, $p$, $f$, $g$, $h$, $k$ and $L$ are the modified equinoctial elements of the spacecraft as per equation \eqref{eq:states}, $w$ and $s^{2}$ are the helper functions as per equations \eqref{eq:w_helper} and \eqref{eq:s2_helper} respectively, $\alpha^{2}=h^{2}-k^{2}$ and $r=\frac{p}{w}$ are two additional helper functions, and $\mu$ once again is the gravitational constant of the primary body the spacecraft is orbiting.

\textcite{Betts1994} demonstrates that the gravitational acceleration $\vec{\Delta_q}$ on a spacecraft due to $n$ multiple bodies within a frame centred on the primary body is described by equation \eqref{eq:third-body-acc},
\begin{equation} \label{eq:third-body-acc}
\vec{\Delta_q}=-\sum_{j=1}^{n}\mu_{j}
\left[\frac{\vec{d}_{j}}{d_{j}^{3}}+\frac{\vec{s}_{j}}{s_{j}^{3}}\right]
\end{equation}
where $\vec{d}$ is the distance of the third body (from the satellite) and $\vec{s}$ is the distance of the third body from the primary body. This is required to remove the bias from the third body attracting the primary body (and thereby, the origin of our reference frame). As explained by \textcite[p. 357]{Kaplan1976}, \enquote{The \emph{effective attraction} of the Moon on a unit mass near Earth is just the Moon's attraction at the mass minus the Moon's attraction at the Earth's center}.

While equation \eqref{eq:third-body-acc} can provide the third body perturbing forces directly, \textcite{Battin1999} shows that the equation is prone to truncation error due to the potentially large difference in distances involved. The algorithm shown in \eqref{eq:Fqk} is recommended,
\begin{subequations}
\begin{equation} \label{eq:Fqk}
F(q_k) = q_k\left[ \frac{3+3q_{k}+q_{k}^{2}}{1+(\sqrt{1+q_{k}})^{3}} \right] 
\end{equation} 
where
\begin{equation}
q_k = \frac{\vec{r}^{T}(\vec{r}-2\vec{s_{k}})}{\vec{s_k}^{T}\vec{s_k}}
\end{equation}
\end{subequations}
The acceleration vector is then resolved as per equation \eqref{eq:delta-v}.
\begin{equation}\label{eq:delta-v}
\vec{\Delta_q} = -\sum_{k=1}^{n}\frac{\mu_{k}}{d_{k}^{3}}(\vec{r}+F(q_{k})\vec{s_{k}})
\end{equation}

These equations are used repeatedly in every phase; to calculate the perturbing forces due to the Moon's gravity (while in the Earth's sphere of influence), the Earth's gravity (while in the Moon's sphere of influence), and the gravity from the Sun, Jupiter, Mars, and Venus. Saturn is usually excluded even from low-thrust long duration studies such as this due to its large orbit (9-10~AU, compared to Jupiter's 5~AU) and comparatively low mass (95~Earths, compared to Jupiter's 317~Earths). Finally, while the gravity due to the other planets and the Moon was calculated from their respective centres of Mass, the total gravity from the Jupiter system was calculated from its barycentre.



% Oblateness
\subsection{Oblateness of primary body} \label{sub:Oblateness}

The Earth is not a perfect sphere. These imperfections are most commonly approximated with spherical harmonics, which models a uniform density ellipsoid. Whilst the differences between a sphere and an ellipsoid of identical mass are only noticable in low altitude orbits, since this is where the spacecraft trajectory is most susceptible to parameter variations it can have a substantial effect on the final state. Consequently it is important to include these variations in the model. Latitudinal harmonics are known as \emph{zonal harmonics}, longitudinal harmonics are known as \emph{sectorial harmonics}, and any combination of the two is known as a \emph{tesseral harmonic}. Some examples of spherical harmonics are shown in \autoref{fig:Spherical-Harmonics}.

\begin{figure}
\caption{Spherical Harmonics. $l$ is the order of the zonal harmonic, $m$ is the order of the sectorial harmonic. Image used courtesy of \cite{web_wiki_SphericalHarmonics}.} \label{fig:Spherical-Harmonics}
\centering
\includegraphics[scale=0.5]{Images/515px-Harmoniques_spheriques_positif_negatif.png}
\end{figure}

The centrifugal force of the Earth spinning causes it to bulge outwards at the equator. This causes the equatorial radius of the Earth to be over 30~km greater than the polar radius, resulting in a significant first zonal harmonic coefficient, $J_{2}$. Since $J_{2}$ is three orders of magnitude greater than $J_{3}$ and $J_{4}$ these higher order terms have often been neglected in simulations, such as those performed by \textcite{Yang2007}. Similar coefficients are available to approximate the shape of the Moon.

However, modelling the central body as an ellipsoid does not allow for inconsistent density of the body's crust. The Moon in particular has very inconsistent density due to the presence of mass concentrations or \emph{mascons}, so severe that most low lunar orbits (LLOs) will decay and impact the surface within 6 months \parencite{Zeile2010}. To include variations in density, recent satellite missions have developed very accurate models of the gravitational potential around the Earth (such as the Gravity Recovery and Climate Experiment mission, GRACE), and the Moon (such as the Gravity Recovery and Interior Laboratory, GRAIL).

Potential energy ($W$) is defined in the Global Geodetic Survey \parencite{WGS84} as per equation \eqref{eq:Total-Grav-Potential},
\begin{equation}\label{eq:Total-Grav-Potential}
W=V+\Phi
\end{equation}
where $\Phi$ is the potential due to the body's angular momentum, when rotating at angular velocity $\omega$ about an axis $r$ metres away, given by equation \eqref{eq:Angular-Momentum}.
\begin{equation}\label{eq:Angular-Momentum}
\Phi=\frac{1}{2}\omega^{2}r^{2}
\end{equation}

The gravitational potential function ($V$, units~m$^{2}$s$^{-2}$) is defined as per equation \eqref{eq:Grav-Potential}. The geographic parameters of satellite radius $r$, longitude $\lambda$ and latitude $\phi$ are calculated by converting the inertial frame to a body-fixed frame, as outlined by the International Earth Rotation Service \parencite{Petit2010}.
\begin{equation} \label{eq:Grav-Potential}
V=\frac{\mu}{r}\left[1+\sum_{n=2}^{n_{max}}\sum_{m=0}^{n}\left(\frac{a}{r}\right)^{n}\bar{P}_{nm}\left(\sin\phi'\right)\left(\bar{C}_{nm}\cos m\lambda+\bar{S}_{nm}\sin m\lambda\right)\right]
\end{equation}
where $\mu$ is the body's gravitational constant (defined in \autoref{sec:Orbital-equations-of-motion}), $a$ is the semi-major axis of the ellipsoid body (defined by \citeauthor{WGS84} as 6378137.0~m for the Earth). $\bar{P}_{nm}\left(\sin\phi'\right)$ represents the series of normalised associated Legendre polynomials, further defined by \textcite{WGS84} as per equation \eqref{eq:Legendre-polys},\\

\begin{subequations}\label{eq:Legendre-polys}
\centering 
Normalized associated Legendre polynomial
\begin{equation}
\bar{P}_{nm}\left(\sin\phi'\right) = \left[\frac{\left(n-m\right)!\left(2n+1\right)k}{\left(n+m\right)!}\right]^{\frac{1}{2}}P_{nm}\left(\sin\phi'\right)
\end{equation}
Associated Legendre polynomial
\begin{equation}
P_{nm}\left(\sin\phi'\right) = \left(\cos\phi'\right)^{m}\frac{d^{m}}{d\left(\sin\phi'\right)^{m}}\left[P_{n}\left(\sin\phi'\right)\right]
\end{equation}
Legendre polynomial
\begin{equation}
P_{n}\left(\sin\phi'\right) = \frac{d^{n}}{2^{n}n!d\left(\sin\phi'\right)^{n}}\left(\sin^{2}\phi'-1\right)^{n}
\end{equation}
\end{subequations}
where parameters $n$ and $m$ represent the degree and order of the normalised gravitational coefficients $C_{nm}$ and $S_{nm}$. It is these normalised coefficients that are calculated, recorded and published. The most detailed measurements of gravitational coefficients for the Earth to date are available from \textcite{EIGEN-5C}.  For $m = 0$, $k = 1$ and for $m \neq 0$, $k = 2$. 

According to the \textcite{WGS84} the series is theoretically valid for $r\geq a$, though it can be used with probably negligible error near or on the body's surface, that is, $r\geq\text{body's surface}$. The series should not be used for $r<\text{body's surface}$.

The normalised gravitational coefficients $\bar{C}_{nm}$ and $\bar{S}_{nm}$ for the Earth were taken from the Joint Gravity Model 3 \parencite[JGM3,][]{Tapley1996} due to availability of data. Several newer models have been released such as the GRACE models mentioned earlier, but the JGM3 accuracy was sufficient for this project. The lunar gravitational model was used from the Lunar Prospector mission \parencite{Konopliv2001}.

The perturbing force acting on the spacecraft is then determined using equation \eqref{eq:Oblateness-perturbation}.
\begin{equation}\label{eq:Oblateness-perturbation}
\vec{\Delta_g}=\nabla W
\end{equation}

Obviously the factorials and summations make this equation inappropriate for repetitive computer evaluation. A recursive algorithm developed by \textcite{Montenbruck2000} was used to simplify the calculation, while still retaining the higher order accuracy. 

The impact of gravitational harmonics is obviously going to be greater at lower altitudes. The Earth harmonics, dominated by the J2 bulge, affect mostly $\omega$ and $\Omega$ \parencite{Eshagh2007, Montenbruck2000}; for example, a sun-synchronous orbit (SSO) precesses around the Earth by 360\degrees\ per year, but suffers minimal inclination change. The equations that approximate this behaviour are reproduced in equation \eqref{eq:Precession}, where $p$ is the periapsis of the orbit.

\begin{subequations}\label{eq:Precession}
\begin{gather}
\dot\Omega = -\pi\frac{3J_2}{p^2\mu}\cos i \\
\dot\omega = \pi\frac{3J_2}{2p^2\mu}(5\cos^2i-1)
\end{gather}
\end{subequations}




% Solar wind
\subsection{Solar wind} \label{sub:Solar-Wind}

The solar wind consists of particles emitted by the Sun, mainly ionised nuclei and electrons. Because of the charged particles in the solar wind, it does not penetrate the magnetosphere around the Earth, except at the magnetic poles. The magnetosphere starts at about 10 Earth radii from the centre of the Earth. Thus, solar wind may be neglected during the ascent phase.

The average solar power density is calculated by dividing the average solar luminosity, $L$,  by the surface area of a sphere centred on the Sun, $4\pi|\vec{r}_\Sun|^2$, giving approximately 1367.5~W of radiation per square metre of area near the Earth-Moon system. The momentum is subsequently determined by dividing through the speed of light, $c$, giving approximately $4.56\times10^{-6}$~Ns per square metre of cross-sectional area per second, in other words, a continual force of $4.56\times10^{-6}$~N on every square metre of area seen from the Sun. This \enquote{constant} forms the basis of \textcite[p. 223]{Chobotov2002}'s equation to average the acceleration of a body due to solar wind. Unfortunately \citeauthor{Chobotov2002}'s equation is intended for spacecraft in geostationary orbit. \BW\ travels much further from the Earth than GEO, and consequently requires calculation of the spacecraft's distance from the Sun to determine average solar pressure, as shown in equation \eqref{eq:solar-wind}.

\begin{equation}\label{eq:solar-wind}
a_{p}=\frac{L_\Sun}{4\pi|\vec{r}_\Sun|^2c}\left(\frac{A_{\text{craft}}}{m_{\text{craft}}}\right)(1+\beta)
\end{equation}
where $a_{p}$ is the magnitude of the acceleration due to solar wind, in ms$^{-2}$, $\beta$ is the optical reflection constant (+1 for total mirror reflection, 0 for total black body absorption, -1 for total transparent transmission), $A_{\text{craft}}$ is the effective satellite projected area, and $m_{\text{craft}}$ is the total spacecraft mass. The speed of light, $c$, is 299792458.0~ms$^{-1}$, and the average solar luminosity, $L$, is $3.846\times10^{26}$~W.

 For a satellite of 200~kg and 6~m$^2$ projected surface area, this gives an acceleration due to solar wind varying from $1.3494\times10^{-7}$~ms$^{-2}$ to $1.4428\times10^{-7}$~ms$^{-2}$ over the course of the year. This force is two orders of magnitude less than the maximum thrust available to \BW.
 
 
 

% Applied thrust
\subsection{Applied thrust} \label{sub:Applied-Thrust}

The \BW\ craft has four PPT thrusters at 1.5~mN each, providing a total thrust of 6~mN. This accelerates the 200~kg craft at $3\times10^{-5}$~ms$^{-2}$. Since the direction of thrust is a design parameter (adjustable by rotating the spacecraft to point the thruster in the desired direction) a unit vector providing this direction is defined in equation \eqref{eq:thrust-vector},
\begin{equation} \label{eq:thrust-vector}
\vec{\hat{u}}=\left[\begin{array}{c}
u_{r}\\
u_{\theta}\\
u_{h}
\end{array}\right]
\end{equation}
such that the thrust vector is given by equation \eqref{eq:thrust-perturbation},
\begin{equation}
\vec{\Delta_{T}}=\frac{T}{m}\vec{\hat{u}} \label{eq:thrust-perturbation}
\end{equation}
where $T$ is the instantaneous thrust, and $m$ is the instantaneous craft wet mass.

In an elliptical orbit, thrust (approximately) tangential to orbital radius is the most efficient way to increase orbital speed and therefore push the spacecraft into a higher orbit. This has the unfortunate side effect of continually increasing the orbital period, and consequently decreasing the rotation rate required to steer the thrust vector (the spacecraft must rotate once per orbit to thrust in a constant direction relative to the Earth). This will need to be compensated for with the attitude control system.

\subsection{Total perturbing forces}

Since these perturbing forces vary over the course of the trajectory, and are often quite computationally intensive to calculate, a plot of them all clearly demonstrates which forces need be included in the optimisation. Since many of these forces vary with a cyclical nature depending on the orbits of the satellite, the Moon and other bodies, the plot in \autoref{fig:Perturbing-forces} shows the upper limit of these forces. Jupiter's gravitational pull is almost negligible compared with the spacecraft's thrust, and the acceleration due to the Earth's $J_{2}$ spherical harmonic (representative of the total force due to Earth oblateness) is only significant for the first $10^{8}$ metres.

\begin{figure}[h]
\caption{Upper limit on perturbing forces between the Earth and the Moon.} \label{fig:Perturbing-forces}
\centering
%\includegraphics[scale=0.4]{Images/relative_forces.png}
\def\svgwidth{\figurewidth}
\input{Images/relative_forces.pdf_tex}
\end{figure}




\section{Summary of orbital dynamics} 

Designing and optimising a low-thrust space trajectory requires a carefully selected, high fidelity model. To this end, reference times or \emph{epochs} were defined, followed by Earth-centred, Moon-centred and spacecraft-centred reference frames. The infrequently used \emph{equinoctial elements} were reproduced from literature as the best available representation of a slowly-changing orbit. The equations of motion derived from these equinoctial elements include a term for perturbing forces, such as 3rd body gravitational forces, gravitational oblateness of the Earth and the Moon, the force acting on the spacecraft due to solar wind, and the applied thrust. %Finally, several key performance indicators were introduced, most notably the specific impulse and delta-v.